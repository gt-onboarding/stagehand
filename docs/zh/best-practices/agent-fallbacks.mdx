---
title: Agent 回退
description: "当页面意外变化需要额外步骤时的安全兜底"
---

## 何时使用 {#when-to-use}

当单步操作意外演变为多步流程时，将 agent 回退用作故障保护。

## 工作原理 {#how-it-works}

1. 先尝试使用 [`act()`](/zh/basics/act) 执行直接动作
2. 若失败，则由 [`agent()`](/zh/basics/agent) 规划新的路径
3. 代理会完成所有必要步骤（打开菜单 → 点击按钮）

### 示例场景 {#example-scenario}

**之前**：Sign in 按钮在页眉\
**之后**：现在需要：点击账户菜单 → 点击 “Sign in” 选项

单个 `act("click sign in")` 无法应对这种变化。Agent 回退可以发现并执行这两个步骤。

<CodeGroup>
  ```typescript TypeScript
  import { Stagehand } from "@browserbasehq/stagehand";

  try {
    await page.act("click the 'Sign In' button");
  } catch (err) {
    console.log("Agent fallback triggered");

    const agent = stagehand.agent({
      provider: "anthropic",
      model: "claude-sonnet-4-20250514",
      instructions: "You are a helpful assistant that can use a web browser.",
    });

    const result = await agent.execute({
      instruction: "Find and click Sign In button",
      maxSteps: 10,
    });

    console.log(result.success ? "Agent fallback success" : "Agent fallback failed");

    if (!result.success) throw err;
  }
  ```

  ```python Python
  from stagehand import Stagehand

  try:
      await page.act("click the 'Sign In' button")
  except Exception as err:
      print("Agent fallback triggered")

      agent = stagehand.agent({
          "provider": "anthropic",
          "model": "claude-sonnet-4-20250514",
          "instructions": "Complete the action, handling any new steps required.",
      })

      result = await agent.execute({
          "instruction": "Find and click Sign In button",
          "max_steps": 10,
      })

      print("Agent fallback success" if result.success else "Agent fallback failed")

      if not result.success:
          raise err
  ```
</CodeGroup>
