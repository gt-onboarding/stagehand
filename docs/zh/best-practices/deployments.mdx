---
title: "部署 Stagehand"
description: "将 AI 代理与自动化部署到云端"
---

<Tip>
  **🌟 预览：Browser Functions** - 使用 Browser Functions 将网页自动化代码直接部署到 Browserbase。零基础设施配置，在云端横向扩展你的 `act()` 自动化。联系 hello@browserbase.com 获取测试版访问权限。
</Tip>

## 部署到 Vercel {#deploy-on-vercel}

在 Vercel Function 中通过 Browserbase 安全运行 Stagehand。本指南提供一个最小可用、可用于生产的 HTTP 端点，你可以直接调用或按计划触发。

### 1. 安装 Vercel CLI {#1-install-vercel-cli}

要下载并安装 Vercel CLI，运行以下任一命令：

<CodeGroup>
  ```bash pnpm
  pnpm i -g vercel
  ```

  ```bash yarn
  yarn global add vercel
  ```

  ```bash npm
  npm i -g vercel
  ```

  ```bash bun
  bun add -g vercel
  ```
</CodeGroup>

### 2. 项目结构 {#2-project-layout}

```text
your-project/
  api/
    run.ts
  package.json
  tsconfig.json
  vercel.json
```

创建该结构：

```bash
mkdir -p api
touch api/run.ts package.json vercel.json tsconfig.json
```

### 3. `api/run.ts`（Node.js 运行时） {#3-apirunts-nodejs-runtime}

```typescript
// api/run.ts
import type { VercelRequest, VercelResponse } from "@vercel/node";
import { Stagehand } from "@browserbasehq/stagehand";
import { z } from "zod";

export default async function handler(req: VercelRequest, res: VercelResponse): Promise<void> {
  try {
    const stagehand = new Stagehand({
      env: "BROWSERBASE",
      apiKey: process.env.BROWSERBASE_API_KEY!,
      projectId: process.env.BROWSERBASE_PROJECT_ID!,
      modelName: "google/gemini-2.5-flash",
      modelClientOptions: {
        apiKey: process.env.GOOGLE_API_KEY!,
      },
      // optional session params
      browserbaseSessionCreateParams: {
        projectId: process.env.BROWSERBASE_PROJECT_ID!,
        region: "us-west-2",
        browserSettings: {
          blockAds: true,
        },
      },
    });

    await stagehand.init();
    const page = stagehand.page;

    await page.goto("https://www.stagehand.dev/");
    await page.act("click the evals button");

    const { extraction } = await page.extract("extract the fastest model");
    const data = { model: extraction ?? "" };

    await stagehand.close();

    res.status(200).json({ ok: true, data: data.model });
  } catch (err: unknown) {
    const msg = err instanceof Error ? err.message : String(err);
    res.status(500).json({ ok: false, error: msg });
  }
}
```

### 4. `package.json` {#4-packagejson}

```json
{
    "name": "bb-stagehand-on-vercel",
    "private": true,
    "type": "module",
    "engines": { "node": ">=18" },
    "dependencies": {
      "@browserbasehq/stagehand": "^2.4.3",
      "zod": "^3.25.0"
    },
    "devDependencies": {
      "typescript": "^5.6.0",
      "@types/node": "^20.12.12",
      "@vercel/node": "^3.2.20"
    }
}
```

### 5. `tsconfig.json` {#5-tsconfigjson}

```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ES2022",
    "moduleResolution": "node",
    "outDir": ".vercel/output/functions",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "types": ["node"]
  },
  "include": ["api/**/*.ts"]
}
```

### 6. `vercel.json` {#6-verceljson}

```json
{
  "$schema": "https://openapi.vercel.sh/vercel.json",
  "functions": {
    "api/run.ts": {
      "maxDuration": 60
    }
  }
}
```

更多详情参见 Vercel 的[配置函数](https://vercel.com/docs/functions/configuring-functions)文档。

### 7. 关联你的项目 {#7-link-your-project}

在配置环境变量之前，将本地文件夹关联到一个 Vercel 项目：

```bash
# 如有需要，先进行认证
vercel login

# 将当前目录关联到一个 Vercel 项目（交互式）
vercel link
```

### 8. 环境变量 {#8-environment-variables}

生产环境中不要提交 `.env`。通过 Vercel CLI 添加变量：

```bash
vercel env add BROWSERBASE_API_KEY
vercel env add BROWSERBASE_PROJECT_ID
# （如果需要，也添加你的模型密钥）
vercel env add GOOGLE_API_KEY
```

另见：[浏览器环境](/zh/configuration/environment) 了解所需变量的详情。

### 9. 本地测试 {#9-test-locally}

在本地复现 Vercel 环境，以便在部署前运行并验证你的 Function。从项目根目录执行。

```bash
# 确保依赖已安装
npm install

# 启动本地 Vercel 开发服务器
vercel dev --listen 5005
```

### 10. 部署 {#10-deploy}

```bash
vercel
vercel --prod
```

### 执行函数 {#execute-the-function}

```bash
curl -X POST https://<your-deployment>/api/run
```

### 可选：在 Vercel 上使用 Cron {#optional-cron-on-vercel}

通过扩展 `vercel.json`，按计划触发相同的端点：

```json
{
  "$schema": "https://openapi.vercel.sh/vercel.json",
  "functions": {
    "api/run.ts": {
      "maxDuration": 60
    }
  },
  "crons": [
    { "path": "/api/run", "schedule": "0 * * * *" }
  ]
}
```

### 功能 {#features}

- 使用 `env: "BROWSERBASE"` 时无需本地浏览器。[Browserbase](https://www.browserbase.com/) 提供浏览器环境。
- 快速响应：将浏览器工作卸载到 Browserbase，快速返回 JSON。
- 长时任务：提高 `maxDuration`，并/或根据套餐考虑 Edge 运行时限制。
