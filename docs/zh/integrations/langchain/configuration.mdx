---
title: "LangChain JS 配置"
sidebarTitle: 配置
description: "将 Stagehand 与 LangChain JS 集成，以创建智能的网页自动化代理"
---

本指南将带你完成将 Stagehand 与 LangChain JS 集成的过程，使用自然语言指令构建强大的网页自动化工作流。

<div id="step-1-install-dependencies">
  ## 步骤 1：安装依赖
</div>

为 LangChain JS 与 Stagehand 集成安装所需的包：

```bash
npm install @langchain/langgraph @langchain/community @langchain/core @browserbasehq/stagehand
```

<div id="step-2-configure-environment-variables">
  ## 步骤 2：配置环境变量
</div>

用于远程浏览器自动化时，请设置 Browserbase 凭据：

```bash
BROWSERBASE_API_KEY="your-browserbase-api-key"
BROWSERBASE_PROJECT_ID="your-browserbase-project-id"
```

<div id="step-3-create-a-stagehand-instance">
  ## 步骤 3：创建 Stagehand 实例
</div>

使用你偏好的配置初始化 Stagehand：

```typescript
import { Stagehand } from "@browserbasehq/stagehand";

// 本地开发
const stagehand = new Stagehand({
    env: "LOCAL",
    verbose: 2,
    enableCaching: false,
});

// 在 Browserbase 上用于生产环境
const stagehand = new Stagehand({
    env: "BROWSERBASE",
    verbose: 1,
    enableCaching: true,
});
```

<div id="step-4-generate-the-stagehandtoolkit">
  ## 步骤 4：生成 StagehandToolkit
</div>

创建一个提供与 LangChain 兼容工具的工具包：

```typescript
import { StagehandToolkit } from '@langchain/community/tools/stagehand';

const stagehandToolkit = await StagehandToolkit.fromStagehand(stagehand);
```

<div id="step-5-use-individual-tools">
  ## 步骤 5：使用单个工具
</div>

该工具包为网页自动化提供了四个专用工具：

<div id="available-tools">
  ### 可用工具
</div>

- **stagehand_navigate**：跳转到指定 URL
- **stagehand_act**：执行浏览器操作（点击、输入等）
- **stagehand_extract**：基于模式提取结构化数据
- **stagehand_observe**：分析页面元素及可执行动作

<div id="basic-tool-usage">
  ### 基本用法
</div>

```typescript
// 访问网站
const navigateTool = stagehandToolkit.tools.find(
    (t) => t.name === "stagehand_navigate"
);
await navigateTool.invoke("https://www.google.com");

// 执行动作
const actionTool = stagehandToolkit.tools.find(
    (t) => t.name === "stagehand_act"
);
await actionTool.invoke('Search for "OpenAI"');

// 观察页面
const observeTool = stagehandToolkit.tools.find(
    (t) => t.name === "stagehand_observe"
);
const result = await observeTool.invoke(
    "What actions can be performed on the current page?"
);
console.log(JSON.parse(result));
```

<div id="step-6-build-langgraph-agents">
  ## 第 6 步：构建 LangGraph 代理
</div>

与 LangGraph 集成，以编排复杂的自动化工作流：

```typescript
npm install @langchain/langgraph @langchain/community @langchain/core @langchain/openai @browserbasehq/stagehand
import { createReactAgent } from "@langchain/langgraph/prebuilt";

// 创建一个 LLM
const llm = new ChatOpenAI({
    model: "gpt-4",
    temperature: 0,
});

// 使用 Stagehand 工具创建代理
const agent = createReactAgent({
    llm,
    tools: stagehandToolkit.tools,
});

// 执行一个复杂的工作流
const result = await agent.invoke({
    messages: [
        {
            role: "user",
            content: "访问 example.com，找到联系表单，并提取所有表单字段"
        }
    ]
});
```

<div id="advanced-configuration">
  ## 高级配置
</div>

<div id="custom-stagehand-configuration">
  ### 自定义 Stagehand 配置
</div>

```typescript
const stagehand = new Stagehand({
    env: "BROWSERBASE",
    verbose: 2,
    enableCaching: true,
    headless: true,
    domSettleTimeoutMs: 5000,
});
```

<div id="error-handling">
  ### 错误处理
</div>

```typescript
try {
    const result = await agent.invoke({
        messages: [{ role: "user", content: "Navigate to invalid-url.com" }]
    });
} catch (error) {
    console.error("自动化失败：", error);
} finally {
    // 释放资源
    await stagehand.close();
}
```

<div id="example-workflows">
  ## 示例工作流
</div>

<Tabs>
  <Tab title="数据提取" value="data-extraction" label="TypeScript">
    ```typescript
    const extractionAgent = createReactAgent({
        llm,
        tools: stagehandToolkit.tools,
    });

    const result = await extractionAgent.invoke({
        messages: [{
            role: "user",
            content: `
                访问 news-website.com 并提取：
                1. 所有文章标题
                2. 发表日期
                3. 作者姓名
                请以结构化 JSON 格式返回
            `
        }]
    });
    ```
  </Tab>
  <Tab title="表单自动化" value="form-automation" label="TypeScript">
    ```typescript
    const formAgent = createReactAgent({
        llm,
        tools: stagehandToolkit.tools,
    });

    const result = await formAgent.invoke({
        messages: [{
            role: "user", 
            content: `
                前往 contact-form.com，并执行以下操作：
                1. 填写联系表单：
                   - Name: John Doe
                   - Email: john@example.com
                   - Message: 关于服务的咨询
                2. 提交表单
                3. 确认提交成功
            `
        }]
    });
    ```
  </Tab>
  <Tab title="多站点调研" value="multi-site-research" label="TypeScript">
    ```typescript
    const researchAgent = createReactAgent({
        llm,
        tools: stagehandToolkit.tools,
    });

    const result = await researchAgent.invoke({
        messages: [{
            role: "user",
            content: `
                按以下步骤调研产品定价：
                1. 访问 competitor1.com 并提取定价信息
                2. 访问 competitor2.com 并提取定价信息
                3. 比较功能与价格
                4. 提供摘要分析
            `
        }]
    });
    ```
  </Tab>
</Tabs>

<CardGroup cols={1}>
  <Card title="LangChain JS 文档" icon="book" href="https://js.langchain.com/docs/integrations/tools/stagehand/">
    Stagehand 集成的官方 LangChain JS 文档
  </Card>
</CardGroup>