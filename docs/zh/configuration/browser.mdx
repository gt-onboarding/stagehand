---
title: 浏览器
sidebarTitle: 浏览器
description: 在 Browserbase 或本地配置 Stagehand
---

Stagehand 支持两种主要环境：

- **Browserbase** - 面向大规模生产级网页自动化优化的云托管浏览器基础设施
- **本地** - 在本机直接运行浏览器，便于开发和调试

<div id="browserbase-environment">
  ## Browserbase 环境
</div>

Browserbase 提供针对大规模网页自动化优化的托管云端浏览器基础设施，具备隐身模式、代理支持和持久化上下文等高级功能。

<Card icon="cloud" title="Browserbase" href="https://docs.browserbase.com" description="了解在可扩展网页自动化中使用 Browserbase 的功能与优势。">
  借助 Browserbase，体验云托管浏览器基础设施的强大能力。
</Card>

<div id="environment-variables">
  ### 环境变量
</div>

开始之前，请先设置所需的环境变量：

<CodeGroup>
```bash .env
BROWSERBASE_API_KEY=your_api_key_here
BROWSERBASE_PROJECT_ID=your_project_id_here
```
</CodeGroup>

<Tip>
在 [Browserbase 控制台](https://browserbase.com/overview) 获取你的 API Key 和 Project ID
</Tip>

<div id="using-stagehand-with-browserbase">
  ### 将 Stagehand 与 Browserbase 配合使用
</div>

<div id="basic-setup">
  #### 基础设置
</div>

最简单的入门方式是使用默认配置：

<CodeGroup>
```typescript TypeScript
import { Stagehand } from "@browserbasehq/stagehand";

const stagehand = new Stagehand({
  env: "BROWSERBASE",
});

await stagehand.init();
```
```python Python
import os
from stagehand import Stagehand

stagehand = Stagehand(
    env="BROWSERBASE",
)

await stagehand.init()
```
</CodeGroup>

<div id="advanced-configuration">
  #### 高级配置
</div>

配置浏览器设置、代理支持以及其他会话参数：
<CodeGroup>
```typescript TypeScript
import { Stagehand } from "@browserbasehq/stagehand";

const stagehand = new Stagehand({
  env: "BROWSERBASE",
  // 可选：API Key 和 Project ID 将直接从环境变量读取
  apiKey: process.env.BROWSERBASE_API_KEY,
  projectId: process.env.BROWSERBASE_PROJECT_ID,
  browserbaseSessionCreateParams: {
    proxies: true,
    region: "us-west-2",
    browserSettings: {
      viewport: { width: 1920, height: 1080 },
      blockAds: true,
    },
  },
});

await stagehand.init();
console.log("Session ID:", stagehand.sessionId);
```
```python Python
import os
from stagehand import Stagehand

stagehand = Stagehand(
    env="BROWSERBASE",
    # 可选：API Key 和 Project ID 将直接从环境变量读取
    api_key=os.getenv("BROWSERBASE_API_KEY"),
    project_id=os.getenv("BROWSERBASE_PROJECT_ID"),
    browserbase_session_create_params={
        "proxies": True,
        "region": "us-west-2",
        "browser_settings": {
            "viewport": {"width": 1920, "height": 1080},
            "block_ads": True,
        },
    },
)
```
</CodeGroup>

<Accordion title="高级 Browserbase 配置示例">
    <CodeGroup>
    ```typescript TypeScript
    const stagehand = new Stagehand({
      env: "BROWSERBASE",
      apiKey: process.env.BROWSERBASE_API_KEY,
      projectId: process.env.BROWSERBASE_PROJECT_ID,
      browserbaseSessionCreateParams: {
        projectId: process.env.BROWSERBASE_PROJECT_ID!,
        proxies: true,
        region: "us-west-2",
        timeout: 3600, // 会话超时时长 1 小时
        keepAlive: true, // Startup 方案可用
        browserSettings: {
          advancedStealth: false, // Scale 方案功能 — 如需启用请联系 support@browserbase.com
          blockAds: true,
          solveCaptchas: true,
          recordSession: false,
          viewport: {
            width: 1920,
            height: 1080,
          },
          fingerprint: {
            browsers: ["chrome", "edge"],
            devices: ["desktop"],
            operatingSystems: ["windows", "macos"],
            locales: ["en-US", "en-GB"],
            httpVersion: 2,
          },
        },
        userMetadata: {
          userId: "automation-user-123",
          environment: "production",
        },
      },
    });
    ```
    ```python Python
    stagehand = Stagehand(
        env="BROWSERBASE",
        api_key=os.getenv("BROWSERBASE_API_KEY"),
        project_id=os.getenv("BROWSERBASE_PROJECT_ID"),
        browserbase_session_create_params={
            "project_id": os.getenv("BROWSERBASE_PROJECT_ID"),
            "proxies": True,
            "region": "us-west-2",
            "timeout": 3600,  # 会话超时时长 1 小时
            "keep_alive": True,  # Startup 方案可用
            "browser_settings": {
                "advanced_stealth": False,  # Scale 方案功能 — 如需启用请联系 support@browserbase.com
                "block_ads": True,
                "solve_captchas": True,
                "record_session": False,
                "viewport": {
                    "width": 1920,
                    "height": 1080,
                },
                "fingerprint": {
                    "browsers": ["chrome", "edge"],
                    "devices": ["desktop"],
                    "operating_systems": ["windows", "macos"],
                    "locales": ["en-US", "en-GB"],
                    "http_version": 2,
                },
            },
            "user_metadata": {
                "user_id": "automation-user-123",
                "environment": "production",
            },
        },
    )
    ```
</CodeGroup>
</Accordion>

<div id="initialization-result">
  #### 初始化结果
</div>

调用 `stagehand.init()` 后，该方法会返回已初始化会话的配置信息：

<CodeGroup>
```typescript TypeScript
const result = await stagehand.init();
console.log(result);
```
```python Python
result = await stagehand.init()
print(result)
```
</CodeGroup>

返回的对象包含：
```Example
{
  debugUrl: 'https://www.browserbase.com/devtools/inspector.html?wss=connect.browserbase.com/debug/f8a21b4a-6fa1-4ab9-9007-fbfe61dc14f0/devtools/page/5474B0E0510C5B6E629BEB06E799CD70?debug=true',
  sessionUrl: 'https://www.browserbase.com/sessions/f8a21b4a-6fa1-4ab9-9007-fbfe61dc14f0',
  sessionId: 'f8a21b4a-6fa1-4ab9-9007-fbfe61dc14f0'
}
```

<AccordionGroup>
<Accordion title="debugUrl">
**打开 Browserbase 的[会话实时视图](https://docs.browserbase.com/features/session-live-view)**，以便引入人参与的闭环（human-in-the-loop）。
</Accordion>

<Accordion title="sessionUrl">
**打开[会话回放](https://docs.browserbase.com/features/session-replay)** 以查看完整的会话录制。
</Accordion>

<Accordion title="sessionId">
[Browserbase 会话](https://docs.browserbase.com/introduction/what-is-browserbase)的**唯一标识符**。用于在 Browserbase 仪表板中识别并连接该会话。
</Accordion>
</AccordionGroup>

<div id="alternative-browserbase-sdk">
  ### 备选方案：Browserbase SDK
</div>

如果你希望直接管理会话，可以使用 Browserbase SDK：

<CodeGroup>
```typescript TypeScript
import { Browserbase } from "@browserbasehq/sdk";

const bb = new Browserbase({ 
  apiKey: process.env.BROWSERBASE_API_KEY! 
});

const session = await bb.sessions.create({
  projectId: process.env.BROWSERBASE_PROJECT_ID!,
  // 在此添加配置选项
});
```
```python Python
from browserbase import Browserbase

bb = Browserbase(api_key=os.environ["BROWSERBASE_API_KEY"])

session = bb.sessions.create(
    project_id=os.environ["BROWSERBASE_PROJECT_ID"],
    # 在此添加配置选项
)
```
</CodeGroup>

<div id="connecting-to-an-existing-session">
  #### 连接到已有会话
</div>

使用其会话 ID 连接到先前创建的 Browserbase 会话：

<CodeGroup>
```typescript TypeScript
import { Stagehand } from "@browserbasehq/stagehand";

const stagehand = new Stagehand({
  env: "BROWSERBASE",
  browserbaseSessionID: "existing-session-uuid-here",
});

await stagehand.init();
console.log("已恢复的会话 ID:", stagehand.sessionId);
```
```python Python
import os
from stagehand import Stagehand

stagehand = Stagehand(
    env="BROWSERBASE",
    browserbase_session_id="existing-session-uuid-here",
)

await stagehand.init()
print(f"已恢复的会话 ID: {stagehand.session_id}")
```
</CodeGroup>

<div id="local-environment">
  ## 本地环境
</div>

本地环境会在你的机器上直接运行浏览器，提供对浏览器实例与配置的完全控制。适合用于开发、调试，以及需要自定义浏览器设置的场景。

<div id="environment-comparison">
  ### 环境对比
</div>

| 功能 | Browserbase | 本地 |
| --- | --- | --- |
| **可扩展性** | 高（云端托管） | 受限（本地资源） |
| **隐身能力** | 高级指纹伪装 | 基础隐身 |
| **代理支持** | 内置住宅代理 | 手动配置 |
| **会话持久化** | 云端上下文存储 | 基于文件的用户数据 |
| **地理分布** | 多区域部署 | 单机 |
| **调试** | 会话录制与日志 | 直接使用 DevTools |
| **搭建复杂度** | 仅需配置环境变量 | 需要安装浏览器 |
| **成本** | 按用量计费 | 基础设施与运维 |
| **最佳适用场景** | 生产、规模化、合规 | 开发、调试 |

<div id="basic-local-setup">
  ### 本地基础配置
</div>

<CodeGroup>
```typescript TypeScript
import { Stagehand } from "@browserbasehq/stagehand";

const stagehand = new Stagehand({
  env: "LOCAL"
});
  
await stagehand.init();
console.log("Session ID:", stagehand.sessionId);
```
```python Python
from stagehand import Stagehand

stagehand = Stagehand(
    env="LOCAL"
)

await stagehand.init()
print(f"Session ID: {stagehand.session_id}")
```
</CodeGroup>

<div id="advanced-local-configuration">
  ### 本地高级配置
</div>

为本地开发自定义浏览器启动选项：

<CodeGroup>
```typescript TypeScript
import { Stagehand } from "@browserbasehq/stagehand";

const stagehand = new Stagehand({
  env: "LOCAL",
  localBrowserLaunchOptions: {
    headless: false, // 显示浏览器窗口
    devtools: true, // 打开开发者工具
    viewport: { width: 1280, height: 720 },
    executablePath: '/opt/google/chrome/chrome', // 自定义 Chrome 路径
    args: [
      '--no-sandbox',
      '--disable-setuid-sandbox',
      '--disable-web-security',
      '--allow-running-insecure-content',
    ],
    env: {
      NODE_ENV: "development",
      DEBUG: "true",
    },
  },
});

await stagehand.init();
```
```python Python
from stagehand import Stagehand

stagehand = Stagehand(
    env="LOCAL",
    headless=False,  # 显示浏览器窗口
    local_browser_launch_options={
        "devtools": True,  # 打开开发者工具
        "viewport": {"width": 1280, "height": 720},
        "executable_path": "/opt/google/chrome/chrome",  # 自定义 Chrome 路径
        "args": [
            "--no-sandbox",
            "--disable-setuid-sandbox",
            "--disable-web-security",
            "--allow-running-insecure-content",
        ],
        "env": {
            "NODE_ENV": "development",
            "DEBUG": "true",
        },
    },
)

await stagehand.init()
```
</CodeGroup>

<div id="connecting-to-your-local-browser">
  ### 连接到本地浏览器
</div>

连接到已在本机运行的 Chrome/Chromium，而不是启动一个新的实例。这样可以在你日常使用的浏览器上进行自动化，保留现有的标签页、扩展和设置。

<CodeGroup>
```typescript TypeScript
import { Stagehand } from "@browserbasehq/stagehand";

const stagehand = new Stagehand({
	env: "LOCAL",
	localBrowserLaunchOptions: {
		cdpUrl: 'http://localhost:9222'
	}
});

await stagehand.init();
```
```python Python
from stagehand import Stagehand

stagehand = Stagehand(
    env="LOCAL",
    local_browser_launch_options={
      cdp_url="http://localhost:9222"
    }
)

await stagehand.init()
```
</CodeGroup>

<div id="troubleshooting">
  ## 故障排查
</div>

<div id="common-issues">
  ### 常见问题
</div>

<AccordionGroup>
<Accordion title="Browserbase 认证错误">
- 核对是否正确设置了 `BROWSERBASE_API_KEY` 和 `BROWSERBASE_PROJECT_ID`
- 检查 API key 是否具备所需权限
- 确保 Browserbase 账户余额/额度充足
</Accordion>

<Accordion title="本地浏览器启动失败">
- 在系统中安装 Chrome 或 Chromium
- 为已安装的 Chrome 设置正确的 `executablePath`
- 检查是否已安装必需依赖（Linux：`libnss3-dev libatk-bridge2.0-dev libgtk-3-dev libxss1 libasound2`）
</Accordion>

<Accordion title="会话超时问题">
- 在 `browserbaseSessionCreateParams.timeout` 中提高会话超时时间
- 对于长时运行的会话使用 `keepAlive: true`
- 监控会话使用情况以避免意外中断
</Accordion>
</AccordionGroup>